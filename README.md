# 期权头寸计算及期货数据统计系统

这是一个基于 PyQt5 开发的桌面应用程序，旨在帮助用户管理期权数据、计算期权头寸，并从大连商品交易所（DCE）获取期货收盘价数据。

## 功能特性

- **期权数据管理**：
  - 录入、修改、保存和删除期权信息，包括期权名称、期货代码、执行价格和初始计提量。
  - 支持批量添加交易日，并自动计算每日冲回量。
  - 交易日数据可视化展示。
- **市场数据获取与更新**：
  - 自动从大连商品交易所（DCE）网站获取指定期货合约的每日收盘价。
  - 支持手动刷新单个期权或所有期权的市场数据。
  - 智能处理数据缺失（N/A）情况，并提供重新获取功能。
- **期权头寸计算**：
  - 根据每日冲回量、实际成交量和平仓量自动计算每日最新头寸。
  - 支持修改特定日期的收盘价和平仓量，并自动重新计算后续头寸。
- **数据查询与展示**：
  - 按日期和期权名称进行查询，可显示单个期权的历史数据。
  - 支持关键词模糊查询，方便查找相关期权。
  - 查询结果分为“未到期期权”和“已到期期权”进行展示。
- **平仓操作记录**：
  - 方便地记录特定期权在特定日期的平仓量。
- **数据持久化**：
  - 数据自动保存到本地 JSON 文件，支持“另存为”和“加载”功能。
- **用户友好界面**：
  - 基于 PyQt5 的直观图形用户界面（GUI）。
  - 异步操作（多线程）避免UI卡顿，提供进度条和取消功能。

## 安装与运行

### 1. 环境准备

本系统基于 Python 3 和 PyQt5 开发。您需要安装以下依赖库：

- `PyQt5`
- `requests`
- `pandas`

您可以使用 pip 安装这些依赖：

```bash
pip install PyQt5 requests pandas
```

### 2. 运行程序

下载或克隆本项目的源代码，然后运行主文件：

```bash
python option_calculator.py
```

## 使用指南

### 1. 期权录入/修改

- **选择期权**：在“选择期权”下拉框中选择一个已存在的期权进行编辑，或选择“新建期权”来创建新的期权。
- **填写期权信息**：
  - **期权名称**：期权的唯一标识，例如“豆粕期权”。
  - **期货代码**：对应期货合约的代码，例如“m2409”。
  - **执行价格**：期权的执行价格。
  - **初始计提量**：期权的初始计提量。
- **添加交易日**：
  - **添加交易日**：选择日期后点击此按钮添加单个交易日。
  - **批量添加交易日**：点击此按钮弹出对话框，可设置起始日期、交易日数量和是否跳过周末，批量生成交易日。
  - **清空交易日**：清空所有已添加的交易日。
  - **删除选中交易日**：删除表格中选中的交易日。
- **保存/更新/删除**：
  - **保存期权**：保存新录入的期权信息。如果期权名称已存在，会提示是否覆盖。
  - **更新期权**：更新已选择期权的信息。
  - **清空输入**：清空所有输入框内容。
  - **删除期权**：删除当前选择的期权。

### 2. 数据查询

- **查询日期**：选择您希望查询数据的截止日期。
- **期权名称**：选择要查询的特定期权，或选择“所有期权”来查询所有期权的数据。
- **查询**：点击此按钮执行普通查询。
- **关键词筛选**：在输入框中输入期权名称的关键词，然后点击“关键词查询”进行模糊查询。
- **重新获取数据**：点击此按钮会从大连商品交易所网站重新获取所选期权或所有期权的市场数据。此操作可能需要一些时间，程序会显示进度条。
- **修改收盘价/平仓量**：在查询结果表格中选中一行，点击对应按钮可以手动修改该日期下的收盘价或平仓量，系统会自动重新计算后续头寸。
- **查询结果**：
  - 如果查询单个期权，将显示该期权在所有交易日（截止查询日期）的详细数据。
  - 如果查询所有期权或使用关键词查询，结果将分为“未到期期权”和“已到期期权”两个表格显示，方便查看。

### 3. 平仓操作

- **期权名称**：选择要记录平仓的期权。
- **平仓日期**：选择发生平仓的交易日。
- **平仓量**：输入平仓的数量。
- **记录平仓**：点击此按钮记录平仓信息，系统会自动重新计算该日期及之后的头寸。

## 数据存储

所有期权数据（包括期权基本信息、交易日、收盘价、成交量、平仓量和头寸）都将自动保存到名为 `options_data.json` 的本地 JSON 文件中。您也可以通过菜单栏的“文件”->“另存为...”或“加载数据...”来管理数据文件。

## 数据来源

期货收盘价数据通过爬取大连商品交易所（DCE）的日行情表获取。请注意，数据获取的稳定性和准确性可能受交易所网站结构变化或网络状况影响。

## 许可证

本项目采用 MIT 许可证。

